<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="klecks-embed.css" />
  </head>
  <body>
    <script src="./klecks/embed.js"></script>
    <script type="text/javascript">
      let save = (function () {
        let a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        return function (blob, fileName) {
          let url = window.URL.createObjectURL(blob);
          a.href = url;
          a.download = fileName;
          a.click();
          window.URL.revokeObjectURL(url);
        };
      })();

      let klecks = new Klecks({
        enableImageDropperImport: true,
        onSubmit: async (onSuccess, onError) => {
          const psd = await klecks.getPSD();
          const png = await klecks.getPNG();
          window.parent.postMessage(
            {
              type: "SUBMIT",
              payload: { psd, png },
            },
            "*",
          );

          onSuccess();
        },
      });

      const transparentCanvas = document.createElement("canvas");
      transparentCanvas.width = 500;
      transparentCanvas.height = 500;

      klecks.openProject({
        width: 500,
        height: 500,
        layers: [
          {
            name: "Background",
            isVisible: true,
            opacity: 1,
            mixModeStr: "source-over",
            image: transparentCanvas,
          },
        ],
      });
    </script>
  </body>
</html>
